<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Figma Variables</title>
    <style id="figma-style"></style>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 2%;
        }
        
        pre {
            text-align: left;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
            height: auto;
            overflow: auto;
        }
        
        button {
            padding: 8px 16px;
            font-size: 14px;
            font-family: Inter, sans-serif;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            border: none;
            color: var(--figma-color-text-onbrand);
            background-color: var(--figma-color-bg-brand);
            width: 100%;
            position: relative;
        }
        
        button:hover {
            background-color: var(--figma-color-bg-brand-hover);
        }
        
        .tooltip {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        button:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        #tab-buttons {
            margin-bottom: 10px;
            display: flex;
        }
        
        .tab-button {
            margin-right: 5px;
        }
        
        .tab {
            cursor: pointer;
            padding: 16px;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 24px;
        }
        
        .tab.active {
            border-bottom: 4px solid var(--figma-color-bg-brand);
            background-color: #f1f1f1;
        }
        
        #tab2 {
            display: flex;
            align-items: center;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="tabs">
        <div class="tab" id="tab1" onclick="changeTab('tab1')">JSON</div>
        <div class="tab" id="tab2" onclick="changeTab('tab2')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M18.5 9.51a4.22 4.22 0 0 1-1.91-1.34A5.77 5.77 0 0 0 12 6a4.72 4.72 0 0 0-5 4 3.23 3.23 0 0 1 3.5-1.49 4.32 4.32 0 0 1 1.91 1.35A5.77 5.77 0 0 0 17 12a4.72 4.72 0 0 0 5-4 3.2 3.2 0 0 1-3.5 1.51zm-13 4.98a4.22 4.22 0 0 1 1.91 1.34A5.77 5.77 0 0 0 12 18a4.72 4.72 0 0 0 5-4 3.23 3.23 0 0 1-3.5 1.49 4.32 4.32 0 0 1-1.91-1.35A5.8 5.8 0 0 0 7 12a4.72 4.72 0 0 0-5 4 3.2 3.2 0 0 1 3.5-1.51z"></path></svg>
            <span>TailwindCSS</span>
        </div>
    </div>



    <div id="content1" class="tab-content">
        <button onclick="copyToClipboard()">Copy to clipboard<span class="tooltip">Copied!</span></button>
        <pre id="output"></pre>

        <!-- Vous pouvez ajouter d'autres éléments ici -->
    </div>

    <div id="content2" class="tab-content">
        <button onclick="copyToClipboardTailwind()">Copy to clipboard<span class="tooltip">Copied!</span></button>
        <pre id="outputTailwind"></pre>
        <!-- Vous pouvez ajouter d'autres éléments ici -->
    </div>
    <script>
        window.onmessage = (event) => {
            const {
                pluginMessage
            } = event.data;
            if (pluginMessage.type === "colorData") {
                const outputElement = document.getElementById("output");
                const outputTailwindElement = document.getElementById("outputTailwind");
                const formattedJson = reformatJson(pluginMessage.data);
                outputElement.textContent = JSON.stringify(formattedJson, null, 2);

                // Transform the JSON to the new format and set it to the second <pre>
                const transformedJson = transformJson(formattedJson);
                outputTailwindElement.textContent = JSON.stringify(transformedJson, null, 2);
            }
        };

        function reformatJson(json) {
            const result = {};
            for (const key in json) {
                const parts = key.split('/');
                let current = result;
                for (let i = 0; i < parts.length; i++) {
                    const part = parts[i];
                    if (i === parts.length - 1) {
                        current[part] = json[key];
                    } else {
                        if (!(part in current)) {
                            current[part] = {};
                        }
                        current = current[part];
                    }
                }
            }
            return result;
        }

        function transformJson(json) {
            const transformed = {};
            for (const key in json) {
                const value = json[key];
                // Check if the value has a Mode object
                if (value.Mode) {
                    for (const modeKey in value.Mode) {
                        const modeValue = value.Mode[modeKey];
                        if (
                            typeof modeValue === "object" &&
                            modeValue.type !== "VARIABLE_ALIAS"
                        ) {
                            const color = rgbaToHex(modeValue);
                            // Add color as a parent of the key.
                            if (!transformed["colors"]) {
                                transformed["colors"] = {};
                            }
                            transformed["colors"][key] = color;
                        }
                    }
                }
            }
            return transformed;
        }


        function rgbaToHex(rgba) {
            // Convert RGBA to hex
            const r = Math.round(rgba.r * 255);
            const g = Math.round(rgba.g * 255);
            const b = Math.round(rgba.b * 255);
            return "#" + ((1 << 24) | (r << 16) | (g << 8) | b).toString(16).slice(1).toUpperCase();
        }


        function copyToClipboard() {
            const str = document.getElementById("output").textContent;
            const el = document.createElement("textarea");
            el.value = str;
            el.setAttribute("readonly", "");
            el.style = {
                position: "absolute",
                left: "-9999px"
            };
            document.body.appendChild(el);
            el.select();
            document.execCommand("copy");
            document.body.removeChild(el);
            var tooltip = document.querySelector(".tooltip");
            tooltip.style.visibility = "visible";
            setTimeout(function() {
                tooltip.style.visibility = "hidden";
            }, 1000);
        }

        function copyToClipboardTailwind() {
            const str = document.getElementById("outputTailwind").textContent;
            const el = document.createElement("textarea");
            el.value = str;
            el.setAttribute("readonly", "");
            el.style = {
                position: "absolute",
                left: "-9999px"
            };
            document.body.appendChild(el);
            el.select();
            document.execCommand("copy");
            document.body.removeChild(el);
            var tooltip = document.querySelector(".tooltip");
            tooltip.style.visibility = "visible";
            setTimeout(function() {
                tooltip.style.visibility = "hidden";
            }, 1000);
        }

        function showTab(id) {
            const tabs = document.querySelectorAll('.tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].style.display = 'none';
            }
            document.getElementById(id).style.display = 'block';
        }

        function changeTab(tabId) {
            var tabs = document.querySelectorAll('.tab');
            var contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                if (tab.id === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            contents.forEach(content => {
                if (content.id === 'content' + tabId.charAt(tabId.length - 1)) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        // Sélectionnez l'onglet 1 par défaut
        window.onload = function() {
            changeTab('tab1');
        }
    </script>
</body>

</html>