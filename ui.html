<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Figma Variables</title>
    <style id="figma-style"></style>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 2%;
        }
        
        pre {
            text-align: left;
            background-color: var(--figma-color-bg-secondary);
            color: var(--figma-color-text);
            padding: 10px;
            border-radius: 8px;
            height: auto;
            overflow: auto;
        }
        
        button {
            padding: 8px 16px;
            font-size: 14px;
            font-family: Inter, sans-serif;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            border: none;
            color: var(--figma-color-text-onbrand);
            background-color: var(--figma-color-bg-brand);
            width: 100%;
            position: relative;
        }
        
        button:hover {
            background-color: var(--figma-color-bg-brand-hover);
        }
        
        .tooltip {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        button:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        #tab-buttons {
            margin-bottom: 10px;
            display: flex;
        }
        
        .tab-button {
            margin-right: 5px;
        }
        
        .tab {
            cursor: pointer;
            padding: 16px;
            width: 100%;
            display: flex;
            justify-content: center;
            border-bottom: 1px solid var(--figma-color-border);
            height: 32px;
            align-items: center;
            color: var(--figma-color-text);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 48px;
            height: 32px;
        }
        
        .tab.active {
            border-bottom: 4px solid var(--figma-color-bg-brand);
            background-color: var(--figma-color-bg-secondary);
            border-radius: 8px 8px 0px 0px;
        }
        
        #tab2 {
            display: flex;
            align-items: center;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        #content2 button {
            margin-bottom: 8px;
        }
        
        #content1 button {
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
    <div class="tabs">
        <div class="tab" id="tab1" onclick="changeTab('tab1')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: var(--figma-color-text);"><path d="M12.823 15.122c-.517 0-.816.491-.816 1.146 0 .661.311 1.126.82 1.126.517 0 .812-.49.812-1.146 0-.604-.291-1.126-.816-1.126z"></path><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM8.022 16.704c0 .961-.461 1.296-1.2 1.296-.176 0-.406-.029-.557-.08l.086-.615c.104.035.239.06.391.06.319 0 .52-.145.52-.67v-2.122h.761v2.131zm1.459 1.291c-.385 0-.766-.1-.955-.205l.155-.631c.204.105.521.211.846.211.35 0 .534-.146.534-.365 0-.211-.159-.331-.564-.476-.562-.195-.927-.506-.927-.996 0-.576.481-1.017 1.277-1.017.38 0 .659.08.861.171l-.172.615c-.135-.065-.375-.16-.705-.16s-.491.15-.491.325c0 .215.19.311.627.476.596.22.876.53.876 1.006.001.566-.436 1.046-1.362 1.046zm3.306.005c-1.001 0-1.586-.755-1.586-1.716 0-1.012.646-1.768 1.642-1.768 1.035 0 1.601.776 1.601 1.707C14.443 17.33 13.773 18 12.787 18zm4.947-.055h-.802l-.721-1.302a12.64 12.64 0 0 1-.585-1.19l-.016.005c.021.445.031.921.031 1.472v1.016h-.701v-3.373h.891l.701 1.236c.2.354.4.775.552 1.155h.014c-.05-.445-.065-.9-.065-1.406v-.985h.702v3.372zM14 9h-1V4l5 5h-4z"></path></svg>
            <span>JSON</span>
        </div>
        <div class="tab" id="tab2" onclick="changeTab('tab2')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: var(--figma-color-text);"><path d="M18.5 9.51a4.22 4.22 0 0 1-1.91-1.34A5.77 5.77 0 0 0 12 6a4.72 4.72 0 0 0-5 4 3.23 3.23 0 0 1 3.5-1.49 4.32 4.32 0 0 1 1.91 1.35A5.77 5.77 0 0 0 17 12a4.72 4.72 0 0 0 5-4 3.2 3.2 0 0 1-3.5 1.51zm-13 4.98a4.22 4.22 0 0 1 1.91 1.34A5.77 5.77 0 0 0 12 18a4.72 4.72 0 0 0 5-4 3.23 3.23 0 0 1-3.5 1.49 4.32 4.32 0 0 1-1.91-1.35A5.8 5.8 0 0 0 7 12a4.72 4.72 0 0 0-5 4 3.2 3.2 0 0 1 3.5-1.51z"></path></svg>
            <span>TailwindCSS</span>
        </div>
    </div>



    <div id="content1" class="tab-content">
        <button onclick="copyToClipboard()">Copy to clipboard<span class="tooltip">Copied!</span></button>
        <button onclick="downloadJson()" id="downloadButton">Download JSON</button>
        <pre id="output"></pre>

        <!-- Vous pouvez ajouter d'autres éléments ici -->
    </div>

    <div id="content2" class="tab-content">
        <button onclick="copyToClipboardTailwind()">Copy to clipboard<span class="tooltip">Copied!</span></button>
        <button onclick="downloadJsonTailwind()" id="downloadButton">Download JSON</button>

        <pre id="outputTailwind"></pre>
        <!-- Vous pouvez ajouter d'autres éléments ici -->
    </div>
    <script>
        window.onmessage = (event) => {
            const {
                pluginMessage
            } = event.data;
            if (pluginMessage.type === "colorData") {
                const outputElement = document.getElementById("output");
                const outputTailwindElement = document.getElementById("outputTailwind");
                const formattedJson = reformatJson(pluginMessage.data);
                outputElement.textContent = JSON.stringify(formattedJson, null, 2);

                // Transform the JSON to the new format and set it to the second <pre>
                const transformedJson = transformJson(formattedJson);
                outputTailwindElement.textContent = JSON.stringify(transformedJson, null, 2);
            }
        };

        function reformatJson(json) {
            const result = {};
            for (const key in json) {
                const parts = key.split('/');
                let current = result;
                for (let i = 0; i < parts.length; i++) {
                    const part = parts[i];
                    if (i === parts.length - 1) {
                        current[part] = json[key];
                    } else {
                        if (!(part in current)) {
                            current[part] = {};
                        }
                        current = current[part];
                    }
                }
            }
            return result;
        }

        function transformJson(json) {
            const transformed = {};
            for (const key in json) {
                const value = json[key];
                // Check if the value is an object and contains a Mode object
                if (value && typeof value === 'object') {
                    if (value.Mode) {
                        processColor(value, transformed, key);
                    } else {
                        for (const innerKey in value) {
                            if (value[innerKey] && value[innerKey].Mode) {
                                processColor(value[innerKey], transformed, `${key}/${innerKey}`);
                            }
                        }
                    }
                }
            }
            return {
                "colors": transformed
            };
        }

        function processColor(value, transformed, key) {
            const modes = Object.keys(value.Mode);
            if (modes.length === 1) {
                const modeValue = value.Mode[modes[0]];
                if (modeValue && typeof modeValue === "object" && modeValue.r !== undefined) {
                    const color = rgbaToHex(modeValue);
                    addToHierarchy(transformed, key, color);
                }
            } else {
                for (let i = 0; i < modes.length; i++) {
                    const modeKey = modes[i];
                    const modeValue = value.Mode[modeKey];
                    if (modeValue && typeof modeValue === "object" && modeValue.r !== undefined) {
                        const color = rgbaToHex(modeValue);
                        if (i === 0) {
                            addToHierarchy(transformed, `${key}/DEFAULT`, color);
                        }
                        addToHierarchy(transformed, `${key}/${modeKey.toLowerCase()}`, color);
                    }
                }
            }
        }



        function addToHierarchy(transformed, key, color) {
            const parts = key.split('/');
            let current = transformed;
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                if (i === parts.length - 1) {
                    current[part] = color;
                } else {
                    if (!(part in current)) {
                        current[part] = {};
                    }
                    current = current[part];
                }
            }
        }


        function rgbaToHex(rgba) {
            // Convert RGBA to hex
            const r = Math.round(rgba.r * 255);
            const g = Math.round(rgba.g * 255);
            const b = Math.round(rgba.b * 255);
            return "#" + ((1 << 24) | (r << 16) | (g << 8) | b).toString(16).slice(1).toUpperCase();
        }


        function copyToClipboard() {
            const str = document.getElementById("output").textContent;
            const el = document.createElement("textarea");
            el.value = str;
            el.setAttribute("readonly", "");
            el.style = {
                position: "absolute",
                left: "-9999px"
            };
            document.body.appendChild(el);
            el.select();
            document.execCommand("copy");
            document.body.removeChild(el);
            var tooltip = document.querySelector(".tooltip");
            tooltip.style.visibility = "visible";
            setTimeout(function() {
                tooltip.style.visibility = "hidden";
            }, 1000);
        }

        function copyToClipboardTailwind() {
            const str = document.getElementById("outputTailwind").textContent;
            const el = document.createElement("textarea");
            el.value = str;
            el.setAttribute("readonly", "");
            el.style = {
                position: "absolute",
                left: "-9999px"
            };
            document.body.appendChild(el);
            el.select();
            document.execCommand("copy");
            document.body.removeChild(el);
            var tooltip = document.querySelector(".tooltip");
            tooltip.style.visibility = "visible";
            setTimeout(function() {
                tooltip.style.visibility = "hidden";
            }, 1000);
        }

        function showTab(id) {
            const tabs = document.querySelectorAll('.tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].style.display = 'none';
            }
            document.getElementById(id).style.display = 'block';
        }

        function changeTab(tabId) {
            var tabs = document.querySelectorAll('.tab');
            var contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                if (tab.id === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            contents.forEach(content => {
                if (content.id === 'content' + tabId.charAt(tabId.length - 1)) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }


        function downloadJsonTailwind() {
            // Get the formatted JSON data
            const data = document.getElementById('outputTailwind').textContent;
            // Create a Blob object from the data
            const blob = new Blob([data], {
                type: 'application/json'
            });
            // Create a URL for the Blob object
            const url = URL.createObjectURL(blob);

            // Create a temporary anchor element and set the href to the Blob URL
            const a = document.createElement('a');
            a.href = url;
            // Set the download attribute to specify the filename
            a.download = 'data.json';
            // Append the anchor element to the body
            document.body.appendChild(a);
            // Programmatically click the anchor element to start the download
            a.click();
            // Finally, remove the anchor element from the body
            document.body.removeChild(a);
        }

        function downloadJson() {
            // Get the formatted JSON data
            const data = document.getElementById('output').textContent;
            // Create a Blob object from the data
            const blob = new Blob([data], {
                type: 'application/json'
            });
            // Create a URL for the Blob object
            const url = URL.createObjectURL(blob);

            // Create a temporary anchor element and set the href to the Blob URL
            const a = document.createElement('a');
            a.href = url;
            // Set the download attribute to specify the filename
            a.download = 'data.json';
            // Append the anchor element to the body
            document.body.appendChild(a);
            // Programmatically click the anchor element to start the download
            a.click();
            // Finally, remove the anchor element from the body
            document.body.removeChild(a);
        }


        // Sélectionnez l'onglet 1 par défaut
        window.onload = function() {
            changeTab('tab1');
        }
    </script>
</body>

</html>